<!DOCTYPE HTML>
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc -->
<title>Merge (venice API)</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<link rel="stylesheet" type="text/css" href="../../../../../stylesheet.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../../../jquery/jquery-ui.min.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../../../jquery-ui.overrides.css" title="Style">
<script type="text/javascript" src="../../../../../script.js"></script>
<script type="text/javascript" src="../../../../../jquery/jszip/dist/jszip.min.js"></script>
<script type="text/javascript" src="../../../../../jquery/jszip-utils/dist/jszip-utils.min.js"></script>
<!--[if IE]>
<script type="text/javascript" src="../../../../../jquery/jszip-utils/dist/jszip-utils-ie.min.js"></script>
<![endif]-->
<script type="text/javascript" src="../../../../../jquery/jquery-3.6.1.min.js"></script>
<script type="text/javascript" src="../../../../../jquery/jquery-ui.min.js"></script>
</head>
<body>
<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="Merge (venice API)";
        }
    }
    catch(err) {
    }
//-->
var data = {"i0":6,"i1":6,"i2":6};
var tabs = {65535:["t0","All Methods"],2:["t2","Instance Methods"],4:["t3","Abstract Methods"]};
var altColor = "altColor";
var rowColor = "rowColor";
var tableTab = "tableTab";
var activeTableTab = "activeTableTab";
var pathtoroot = "../../../../../";
var useModuleDirectories = true;
loadScripts(document, 'script');</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<header role="banner">
<nav role="navigation">
<div class="fixedNav">
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a id="navbar.top">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.top" title="Skip navigation links">Skip navigation links</a></div>
<a id="navbar.top.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../index.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../../../allclasses.html">All&nbsp;Classes</a></li>
</ul>
<ul class="navListSearch">
<li><label for="search">SEARCH:</label>
<input type="text" id="search" value="search" disabled="disabled">
<input type="reset" id="reset" value="reset" disabled="disabled">
</li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a id="skip.navbar.top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
</div>
<div class="navPadding">&nbsp;</div>
<script type="text/javascript"><!--
$('.navPadding').css('padding-top', $('.fixedNav').css("height"));
//-->
</script>
</nav>
</header>
<!-- ======== START OF CLASS DATA ======== -->
<main role="main">
<div class="header">
<div class="subTitle"><span class="packageLabelInType">Package</span>&nbsp;<a href="package-summary.html">com.linkedin.davinci.replication.merge</a></div>
<h2 title="Interface Merge" class="title">Interface Merge&lt;T&gt;</h2>
</div>
<div class="contentContainer">
<div class="description">
<ul class="blockList">
<li class="blockList">
<dl>
<dt>All Known Implementing Classes:</dt>
<dd><code><a href="MergeByteBuffer.html" title="class in com.linkedin.davinci.replication.merge">MergeByteBuffer</a></code>, <code><a href="MergeGenericRecord.html" title="class in com.linkedin.davinci.replication.merge">MergeGenericRecord</a></code></dd>
</dl>
<hr>
<pre>public interface <span class="typeNameLabel">Merge&lt;T&gt;</span></pre>
<div class="block">API for merging existing data with incoming writes.

 There should be at least one implementation of this interface for each version of the replication metadata protocol, and
 possibly more if multiple competing implementations are created in an attempt to optimize performance,
 efficiency or other considerations.

 Conceptually, the various functions merge together 4 elements relating to a given key in the store:

 1. The old value associated with the key
 2. The old replication metadata associated with the old value
 3. The incoming write operation for that key (absent in case of deletes)
 4. The timestamp of the write operation

 Conflict resolution rules must be applied deterministically such that given an old value and an old replication metadata, a
 set of write operations (and their associated timestamp) may be applied in any order and always converge to
 the same end result (i.e. to the same final value and replication metadata). This determinism is achieved by the following
 rules:

 1. The fields which are set in the write operation will clobber those of the old value if and only if the write
    operation timestamp is greater than the timestamp associated with that field in the replication metadata.
 2. Each element included in a collection merging operation is applied to the corresponding collection in
    the old value iif the write operation timestamp is greater than the timestamp of the corresponding
    element, than the timestamp of the corresponding element's tombstone, and than the collection's timestamp.
 3. In case of equal timestamps, the value of the field or of the element is compared to that of the old field
    or element in order to deterministically decide which one wins the conflict resolution.

 Note: all implementation must return the reference of the same <a href="../../schema/merge/ValueAndRmd.html" title="class in com.linkedin.davinci.schema.merge"><code>ValueAndRmd</code></a> instance that was
 passed in. The input <a href="../../schema/merge/ValueAndRmd.html" title="class in com.linkedin.davinci.schema.merge"><code>ValueAndRmd</code></a> object may be mutated or replaced its inner variables. As such,
 a caller of this function should not expect the passed in parameter to remain unchanged.</div>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- ========== METHOD SUMMARY =========== -->
<section>
<ul class="blockList">
<li class="blockList"><a id="method.summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<table class="memberSummary">
<caption><span id="t0" class="activeTableTab"><span>All Methods</span><span class="tabEnd">&nbsp;</span></span><span id="t2" class="tableTab"><span><a href="javascript:show(2);">Instance Methods</a></span><span class="tabEnd">&nbsp;</span></span><span id="t3" class="tableTab"><span><a href="javascript:show(4);">Abstract Methods</a></span><span class="tabEnd">&nbsp;</span></span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colSecond" scope="col">Method</th>
<th class="colLast" scope="col">Description</th>
</tr>
<tr id="i0" class="altColor">
<td class="colFirst"><code><a href="../../schema/merge/ValueAndRmd.html" title="class in com.linkedin.davinci.schema.merge">ValueAndRmd</a>&lt;<a href="Merge.html" title="type parameter in Merge">T</a>&gt;</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#delete(com.linkedin.davinci.schema.merge.ValueAndRmd,long,int,long,int)">delete</a></span>&#8203;(<a href="../../schema/merge/ValueAndRmd.html" title="class in com.linkedin.davinci.schema.merge">ValueAndRmd</a>&lt;<a href="Merge.html" title="type parameter in Merge">T</a>&gt;&nbsp;oldValueAndRmd,
      long&nbsp;deleteOperationTimestamp,
      int&nbsp;deleteOperationColoID,
      long&nbsp;newValueSourceOffset,
      int&nbsp;newValueSourceBrokerID)</code></th>
<td class="colLast">&nbsp;</td>
</tr>
<tr id="i1" class="rowColor">
<td class="colFirst"><code><a href="../../schema/merge/ValueAndRmd.html" title="class in com.linkedin.davinci.schema.merge">ValueAndRmd</a>&lt;<a href="Merge.html" title="type parameter in Merge">T</a>&gt;</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#put(com.linkedin.davinci.schema.merge.ValueAndRmd,T,long,int,long,int)">put</a></span>&#8203;(<a href="../../schema/merge/ValueAndRmd.html" title="class in com.linkedin.davinci.schema.merge">ValueAndRmd</a>&lt;<a href="Merge.html" title="type parameter in Merge">T</a>&gt;&nbsp;oldValueAndRmd,
   <a href="Merge.html" title="type parameter in Merge">T</a>&nbsp;newValue,
   long&nbsp;putOperationTimestamp,
   int&nbsp;putOperationColoID,
   long&nbsp;newValueSourceOffset,
   int&nbsp;newValueSourceBrokerID)</code></th>
<td class="colLast">&nbsp;</td>
</tr>
<tr id="i2" class="altColor">
<td class="colFirst"><code><a href="../../schema/merge/ValueAndRmd.html" title="class in com.linkedin.davinci.schema.merge">ValueAndRmd</a>&lt;<a href="Merge.html" title="type parameter in Merge">T</a>&gt;</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#update(com.linkedin.davinci.schema.merge.ValueAndRmd,com.linkedin.venice.utils.lazy.Lazy,org.apache.avro.Schema,long,int,long,int)">update</a></span>&#8203;(<a href="../../schema/merge/ValueAndRmd.html" title="class in com.linkedin.davinci.schema.merge">ValueAndRmd</a>&lt;<a href="Merge.html" title="type parameter in Merge">T</a>&gt;&nbsp;oldValueAndRmd,
      <a href="../../../venice/utils/lazy/Lazy.html" title="interface in com.linkedin.venice.utils.lazy">Lazy</a>&lt;org.apache.avro.generic.GenericRecord&gt;&nbsp;writeOperation,
      org.apache.avro.Schema&nbsp;currValueSchema,
      long&nbsp;updateOperationTimestamp,
      int&nbsp;updateOperationColoID,
      long&nbsp;newValueSourceOffset,
      int&nbsp;newValueSourceBrokerID)</code></th>
<td class="colLast">&nbsp;</td>
</tr>
</table>
</li>
</ul>
</section>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ============ METHOD DETAIL ========== -->
<section>
<ul class="blockList">
<li class="blockList"><a id="method.detail">
<!--   -->
</a>
<h3>Method Detail</h3>
<a id="put(com.linkedin.davinci.schema.merge.ValueAndRmd,java.lang.Object,long,int,long,int)">
<!--   -->
</a><a id="put(com.linkedin.davinci.schema.merge.ValueAndRmd,T,long,int,long,int)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>put</h4>
<pre class="methodSignature"><a href="../../schema/merge/ValueAndRmd.html" title="class in com.linkedin.davinci.schema.merge">ValueAndRmd</a>&lt;<a href="Merge.html" title="type parameter in Merge">T</a>&gt;&nbsp;put&#8203;(<a href="../../schema/merge/ValueAndRmd.html" title="class in com.linkedin.davinci.schema.merge">ValueAndRmd</a>&lt;<a href="Merge.html" title="type parameter in Merge">T</a>&gt;&nbsp;oldValueAndRmd,
                   <a href="Merge.html" title="type parameter in Merge">T</a>&nbsp;newValue,
                   long&nbsp;putOperationTimestamp,
                   int&nbsp;putOperationColoID,
                   long&nbsp;newValueSourceOffset,
                   int&nbsp;newValueSourceBrokerID)</pre>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>oldValueAndRmd</code> - the old value and replication metadata which are persisted in the server prior
                                       to the write operation. Note that some implementation(s) may require the old
                                       value to be non-null. Please refer to the Javadoc of specific implementation.</dd>
<dd><code>newValue</code> - a record with all fields populated and with one of the registered value schemas</dd>
<dd><code>putOperationTimestamp</code> - the timestamp of the incoming write operation</dd>
<dd><code>putOperationColoID</code> - ID of the colo/fabric where this PUT request was originally received.</dd>
<dd><code>newValueSourceOffset</code> - The offset from which the new value originates in the realtime stream.  Used to build
                               the ReplicationMetadata for the newly inserted record.</dd>
<dd><code>newValueSourceBrokerID</code> - The ID of the broker from which the new value originates.  ID's should correspond
                                 to the kafkaClusterUrlIdMap configured in the LeaderFollowerIngestionTask.  Used to build
                                 the ReplicationMetadata for the newly inserted record.</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>the resulting <a href="../../schema/merge/ValueAndRmd.html" title="class in com.linkedin.davinci.schema.merge"><code>ValueAndRmd</code></a> after merging the old one with the incoming write operation.
         The returned object is guaranteed to be "==" to the input oldValueAndReplicationMetadata object and the internal
         members of the object are possibly mutated.</dd>
</dl>
</li>
</ul>
<a id="delete(com.linkedin.davinci.schema.merge.ValueAndRmd,long,int,long,int)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>delete</h4>
<pre class="methodSignature"><a href="../../schema/merge/ValueAndRmd.html" title="class in com.linkedin.davinci.schema.merge">ValueAndRmd</a>&lt;<a href="Merge.html" title="type parameter in Merge">T</a>&gt;&nbsp;delete&#8203;(<a href="../../schema/merge/ValueAndRmd.html" title="class in com.linkedin.davinci.schema.merge">ValueAndRmd</a>&lt;<a href="Merge.html" title="type parameter in Merge">T</a>&gt;&nbsp;oldValueAndRmd,
                      long&nbsp;deleteOperationTimestamp,
                      int&nbsp;deleteOperationColoID,
                      long&nbsp;newValueSourceOffset,
                      int&nbsp;newValueSourceBrokerID)</pre>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>oldValueAndRmd</code> - the old value and replication metadata which are persisted in the server prior to the write operation</dd>
<dd><code>newValueSourceOffset</code> - The offset from which the new value originates in the realtime stream.  Used to build
                               the ReplicationMetadata for the newly inserted record.</dd>
<dd><code>deleteOperationColoID</code> - ID of the colo/fabric where this DELETE request was originally received.</dd>
<dd><code>newValueSourceBrokerID</code> - The ID of the broker from which the new value originates.  ID's should correspond
                                 to the kafkaClusterUrlIdMap configured in the LeaderFollowerIngestionTask.  Used to build
                                 the ReplicationMetadata for the newly inserted record.</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>the resulting <a href="../../schema/merge/ValueAndRmd.html" title="class in com.linkedin.davinci.schema.merge"><code>ValueAndRmd</code></a> after merging the old one with the incoming delete operation.
         The returned object is guaranteed to be "==" to the input oldValueAndReplicationMetadata object and the internal
         members of the object are possibly mutated.</dd>
</dl>
</li>
</ul>
<a id="update(com.linkedin.davinci.schema.merge.ValueAndRmd,com.linkedin.venice.utils.lazy.Lazy,org.apache.avro.Schema,long,int,long,int)">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>update</h4>
<pre class="methodSignature"><a href="../../schema/merge/ValueAndRmd.html" title="class in com.linkedin.davinci.schema.merge">ValueAndRmd</a>&lt;<a href="Merge.html" title="type parameter in Merge">T</a>&gt;&nbsp;update&#8203;(<a href="../../schema/merge/ValueAndRmd.html" title="class in com.linkedin.davinci.schema.merge">ValueAndRmd</a>&lt;<a href="Merge.html" title="type parameter in Merge">T</a>&gt;&nbsp;oldValueAndRmd,
                      <a href="../../../venice/utils/lazy/Lazy.html" title="interface in com.linkedin.venice.utils.lazy">Lazy</a>&lt;org.apache.avro.generic.GenericRecord&gt;&nbsp;writeOperation,
                      org.apache.avro.Schema&nbsp;currValueSchema,
                      long&nbsp;updateOperationTimestamp,
                      int&nbsp;updateOperationColoID,
                      long&nbsp;newValueSourceOffset,
                      int&nbsp;newValueSourceBrokerID)</pre>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>oldValueAndRmd</code> - the old value and replication metadata which are persisted in the server prior to the write operation</dd>
<dd><code>writeOperation</code> - a record with a write compute schema</dd>
<dd><code>currValueSchema</code> - Schema of the current value that is to-be-updated here.</dd>
<dd><code>writeComputeSchema</code> - Schema used to generate the write compute record. This schema could be a union and that is
                           why this schema is needed when we already pass in the <code>writeOperation</code> generic record.</dd>
<dd><code>updateOperationTimestamp</code> - the timestamp of the incoming write operation</dd>
<dd><code>updateOperationColoID</code> - ID of the colo/fabric where this UPDATE request was originally received.</dd>
<dd><code>newValueSourceOffset</code> - The offset from which the new value originates in the realtime stream.  Used to build
                               the ReplicationMetadata for the newly inserted record.</dd>
<dd><code>newValueSourceBrokerID</code> - The ID of the broker from which the new value originates.  ID's should correspond
                                 to the kafkaClusterUrlIdMap configured in the LeaderFollowerIngestionTask.  Used to build
                                 the ReplicationMetadata for the newly inserted record.</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>the resulting <a href="../../schema/merge/ValueAndRmd.html" title="class in com.linkedin.davinci.schema.merge"><code>ValueAndRmd</code></a> after merging the old one with the incoming write operation.
         The returned object is guaranteed to be "==" to the input oldValueAndReplicationMetadata object and the internal
         members of the object are possibly mutated.</dd>
</dl>
</li>
</ul>
</li>
</ul>
</section>
</li>
</ul>
</div>
</div>
</main>
<!-- ========= END OF CLASS DATA ========= -->
<footer role="contentinfo">
<nav role="navigation">
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a id="navbar.bottom">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.bottom" title="Skip navigation links">Skip navigation links</a></div>
<a id="navbar.bottom.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../index.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../../../allclasses.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a id="skip.navbar.bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
</nav>
</footer>
</body>
</html>
