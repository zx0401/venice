<!DOCTYPE HTML>
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc -->
<title>InstanceHealthMonitor (venice API)</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<link rel="stylesheet" type="text/css" href="../../../../../stylesheet.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../../../jquery/jquery-ui.min.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../../../jquery-ui.overrides.css" title="Style">
<script type="text/javascript" src="../../../../../script.js"></script>
<script type="text/javascript" src="../../../../../jquery/jszip/dist/jszip.min.js"></script>
<script type="text/javascript" src="../../../../../jquery/jszip-utils/dist/jszip-utils.min.js"></script>
<!--[if IE]>
<script type="text/javascript" src="../../../../../jquery/jszip-utils/dist/jszip-utils-ie.min.js"></script>
<![endif]-->
<script type="text/javascript" src="../../../../../jquery/jquery-3.6.1.min.js"></script>
<script type="text/javascript" src="../../../../../jquery/jquery-ui.min.js"></script>
</head>
<body>
<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="InstanceHealthMonitor (venice API)";
        }
    }
    catch(err) {
    }
//-->
var data = {"i0":10,"i1":10,"i2":10,"i3":10,"i4":10,"i5":10,"i6":10,"i7":10,"i8":10};
var tabs = {65535:["t0","All Methods"],2:["t2","Instance Methods"],8:["t4","Concrete Methods"]};
var altColor = "altColor";
var rowColor = "rowColor";
var tableTab = "tableTab";
var activeTableTab = "activeTableTab";
var pathtoroot = "../../../../../";
var useModuleDirectories = true;
loadScripts(document, 'script');</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<header role="banner">
<nav role="navigation">
<div class="fixedNav">
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a id="navbar.top">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.top" title="Skip navigation links">Skip navigation links</a></div>
<a id="navbar.top.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../index.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../../../allclasses.html">All&nbsp;Classes</a></li>
</ul>
<ul class="navListSearch">
<li><label for="search">SEARCH:</label>
<input type="text" id="search" value="search" disabled="disabled">
<input type="reset" id="reset" value="reset" disabled="disabled">
</li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor.summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor.detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a id="skip.navbar.top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
</div>
<div class="navPadding">&nbsp;</div>
<script type="text/javascript"><!--
$('.navPadding').css('padding-top', $('.fixedNav').css("height"));
//-->
</script>
</nav>
</header>
<!-- ======== START OF CLASS DATA ======== -->
<main role="main">
<div class="header">
<div class="subTitle"><span class="packageLabelInType">Package</span>&nbsp;<a href="package-summary.html">com.linkedin.venice.fastclient.meta</a></div>
<h2 title="Class InstanceHealthMonitor" class="title">Class InstanceHealthMonitor</h2>
</div>
<div class="contentContainer">
<ul class="inheritance">
<li>java.lang.Object</li>
<li>
<ul class="inheritance">
<li>com.linkedin.venice.fastclient.meta.InstanceHealthMonitor</li>
</ul>
</li>
</ul>
<div class="description">
<ul class="blockList">
<li class="blockList">
<dl>
<dt>All Implemented Interfaces:</dt>
<dd><code>java.io.Closeable</code>, <code>java.lang.AutoCloseable</code></dd>
</dl>
<hr>
<pre>public class <span class="typeNameLabel">InstanceHealthMonitor</span>
extends java.lang.Object
implements java.io.Closeable</pre>
<div class="block">The class is used to measure the healthiness about the cluster the store belongs to.
 So far, it is per store because of the following reasons:
 1. Simplify the logic in this class since we don't need to maintain the per-store status, such as quota related responses.
 2. Isolate the healthiness decision among different stores to reduce the impact of false signal.
 There are concerns with this approach as well, for example, the mis-behaving instances will take a longer time to be discovered
 in each store.

 This class is using the pending requests + response status of each Route to decide the healthiness.
 1. For the good response, the pending request counter will be reset when receiving the response.
 2. For the error response, the pending request counter reset will be delayed, which is a way to downgrade the instance.
 3. When the pending request counter exceeds the pre-defined threshold, the instance will be completely blocked.</div>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<section>
<ul class="blockList">
<li class="blockList"><a id="constructor.summary">
<!--   -->
</a>
<h3>Constructor Summary</h3>
<table class="memberSummary">
<caption><span>Constructors</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Constructor</th>
<th class="colLast" scope="col">Description</th>
</tr>
<tr class="altColor">
<th class="colConstructorName" scope="row"><code><span class="memberNameLink"><a href="#%3Cinit%3E(com.linkedin.venice.fastclient.ClientConfig)">InstanceHealthMonitor</a></span>&#8203;(<a href="../ClientConfig.html" title="class in com.linkedin.venice.fastclient">ClientConfig</a>&nbsp;clientConfig)</code></th>
<td class="colLast">&nbsp;</td>
</tr>
</table>
</li>
</ul>
</section>
<!-- ========== METHOD SUMMARY =========== -->
<section>
<ul class="blockList">
<li class="blockList"><a id="method.summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<table class="memberSummary">
<caption><span id="t0" class="activeTableTab"><span>All Methods</span><span class="tabEnd">&nbsp;</span></span><span id="t2" class="tableTab"><span><a href="javascript:show(2);">Instance Methods</a></span><span class="tabEnd">&nbsp;</span></span><span id="t4" class="tableTab"><span><a href="javascript:show(8);">Concrete Methods</a></span><span class="tabEnd">&nbsp;</span></span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colSecond" scope="col">Method</th>
<th class="colLast" scope="col">Description</th>
</tr>
<tr id="i0" class="altColor">
<td class="colFirst"><code>void</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#close()">close</a></span>()</code></th>
<td class="colLast">&nbsp;</td>
</tr>
<tr id="i1" class="rowColor">
<td class="colFirst"><code>int</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#getBlockedInstanceCount()">getBlockedInstanceCount</a></span>()</code></th>
<td class="colLast">&nbsp;</td>
</tr>
<tr id="i2" class="altColor">
<td class="colFirst"><code>int</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#getPendingRequestCounter(java.lang.String)">getPendingRequestCounter</a></span>&#8203;(java.lang.String&nbsp;instance)</code></th>
<td class="colLast">&nbsp;</td>
</tr>
<tr id="i3" class="rowColor">
<td class="colFirst"><code><a href="../../../alpini/base/concurrency/TimeoutProcessor.html" title="class in com.linkedin.alpini.base.concurrency">TimeoutProcessor</a></code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#getTimeoutProcessor()">getTimeoutProcessor</a></span>()</code></th>
<td class="colLast">&nbsp;</td>
</tr>
<tr id="i4" class="altColor">
<td class="colFirst"><code>int</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#getUnhealthyInstanceCount()">getUnhealthyInstanceCount</a></span>()</code></th>
<td class="colLast">&nbsp;</td>
</tr>
<tr id="i5" class="rowColor">
<td class="colFirst"><code>boolean</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#isInstanceBlocked(java.lang.String)">isInstanceBlocked</a></span>&#8203;(java.lang.String&nbsp;instance)</code></th>
<td class="colLast">
<div class="block">If an instance is blocked, it won't be considered for new requests until the requests are closed either
 in a proper manner or closed by {@link #trackHealthBasedOnRequestToInstance#timeoutFuture}</div>
</td>
</tr>
<tr id="i6" class="altColor">
<td class="colFirst"><code>boolean</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#isInstanceHealthy(java.lang.String)">isInstanceHealthy</a></span>&#8203;(java.lang.String&nbsp;instance)</code></th>
<td class="colLast">
<div class="block">If an instance is marked unhealthy, this instances will be retried again continuously to know
 if that instance comes back up and start serving requests.</div>
</td>
</tr>
<tr id="i7" class="rowColor">
<td class="colFirst"><code><a href="../../utils/concurrent/ChainedCompletableFuture.html" title="class in com.linkedin.venice.utils.concurrent">ChainedCompletableFuture</a>&lt;java.lang.Integer,&#8203;java.lang.Integer&gt;</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#trackHealthBasedOnRequestToInstance(java.lang.String)">trackHealthBasedOnRequestToInstance</a></span>&#8203;(java.lang.String&nbsp;instance)</code></th>
<td class="colLast">&nbsp;</td>
</tr>
<tr id="i8" class="altColor">
<td class="colFirst"><code><a href="../../utils/concurrent/ChainedCompletableFuture.html" title="class in com.linkedin.venice.utils.concurrent">ChainedCompletableFuture</a>&lt;java.lang.Integer,&#8203;java.lang.Integer&gt;</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#trackHealthBasedOnRequestToInstance(java.lang.String,java.util.concurrent.CompletableFuture)">trackHealthBasedOnRequestToInstance</a></span>&#8203;(java.lang.String&nbsp;instance,
                                   java.util.concurrent.CompletableFuture&lt;<a href="../../client/store/transport/TransportClientResponse.html" title="class in com.linkedin.venice.client.store.transport">TransportClientResponse</a>&gt;&nbsp;transportFuture)</code></th>
<td class="colLast">
<div class="block">This function tracks the health of an Instance based on the request sent to that Instance:
 by returning an incomplete completable future for <a href="AbstractStoreMetadata.html" title="class in com.linkedin.venice.fastclient.meta"><code>AbstractStoreMetadata</code></a> which
 1.</div>
</td>
</tr>
</table>
<ul class="blockList">
<li class="blockList"><a id="methods.inherited.from.class.java.lang.Object">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;java.lang.Object</h3>
<code>clone, equals, finalize, getClass, hashCode, notify, notifyAll, toString, wait, wait, wait</code></li>
</ul>
</li>
</ul>
</section>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<section>
<ul class="blockList">
<li class="blockList"><a id="constructor.detail">
<!--   -->
</a>
<h3>Constructor Detail</h3>
<a id="&lt;init&gt;(com.linkedin.venice.fastclient.ClientConfig)">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>InstanceHealthMonitor</h4>
<pre>public&nbsp;InstanceHealthMonitor&#8203;(<a href="../ClientConfig.html" title="class in com.linkedin.venice.fastclient">ClientConfig</a>&nbsp;clientConfig)</pre>
</li>
</ul>
</li>
</ul>
</section>
<!-- ============ METHOD DETAIL ========== -->
<section>
<ul class="blockList">
<li class="blockList"><a id="method.detail">
<!--   -->
</a>
<h3>Method Detail</h3>
<a id="getTimeoutProcessor()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getTimeoutProcessor</h4>
<pre class="methodSignature">public&nbsp;<a href="../../../alpini/base/concurrency/TimeoutProcessor.html" title="class in com.linkedin.alpini.base.concurrency">TimeoutProcessor</a>&nbsp;getTimeoutProcessor()</pre>
</li>
</ul>
<a id="trackHealthBasedOnRequestToInstance(java.lang.String)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>trackHealthBasedOnRequestToInstance</h4>
<pre class="methodSignature">public&nbsp;<a href="../../utils/concurrent/ChainedCompletableFuture.html" title="class in com.linkedin.venice.utils.concurrent">ChainedCompletableFuture</a>&lt;java.lang.Integer,&#8203;java.lang.Integer&gt;&nbsp;trackHealthBasedOnRequestToInstance&#8203;(java.lang.String&nbsp;instance)</pre>
</li>
</ul>
<a id="trackHealthBasedOnRequestToInstance(java.lang.String,java.util.concurrent.CompletableFuture)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>trackHealthBasedOnRequestToInstance</h4>
<pre class="methodSignature">public&nbsp;<a href="../../utils/concurrent/ChainedCompletableFuture.html" title="class in com.linkedin.venice.utils.concurrent">ChainedCompletableFuture</a>&lt;java.lang.Integer,&#8203;java.lang.Integer&gt;&nbsp;trackHealthBasedOnRequestToInstance&#8203;(java.lang.String&nbsp;instance,
                                                                                                               java.util.concurrent.CompletableFuture&lt;<a href="../../client/store/transport/TransportClientResponse.html" title="class in com.linkedin.venice.client.store.transport">TransportClientResponse</a>&gt;&nbsp;transportFuture)</pre>
<div class="block">This function tracks the health of an Instance based on the request sent to that Instance:
 by returning an incomplete completable future for <a href="AbstractStoreMetadata.html" title="class in com.linkedin.venice.fastclient.meta"><code>AbstractStoreMetadata</code></a> which
 1. increments <a href="#pendingRequestCounterMap"><code>pendingRequestCounterMap</code></a> for each server instances
    per store. This is done in this function which is called before starting a get() request.
 2. whenComplete() of this completable future decrements the above counters once the response
    for the get() request is received.

 Using this we can track the number of pending requests for each server instance.</div>
</li>
</ul>
<a id="isInstanceHealthy(java.lang.String)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>isInstanceHealthy</h4>
<pre class="methodSignature">public&nbsp;boolean&nbsp;isInstanceHealthy&#8203;(java.lang.String&nbsp;instance)</pre>
<div class="block">If an instance is marked unhealthy, this instances will be retried again continuously to know
 if that instance comes back up and start serving requests. Note that these instances will
 eventually become blocked when it reaches the threshold for pendingRequestCounter. This
 provides some break between continuously sending requests to these instances.</div>
</li>
</ul>
<a id="isInstanceBlocked(java.lang.String)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>isInstanceBlocked</h4>
<pre class="methodSignature">public&nbsp;boolean&nbsp;isInstanceBlocked&#8203;(java.lang.String&nbsp;instance)</pre>
<div class="block">If an instance is blocked, it won't be considered for new requests until the requests are closed either
 in a proper manner or closed by {@link #trackHealthBasedOnRequestToInstance#timeoutFuture}</div>
</li>
</ul>
<a id="getBlockedInstanceCount()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getBlockedInstanceCount</h4>
<pre class="methodSignature">public&nbsp;int&nbsp;getBlockedInstanceCount()</pre>
</li>
</ul>
<a id="getUnhealthyInstanceCount()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getUnhealthyInstanceCount</h4>
<pre class="methodSignature">public&nbsp;int&nbsp;getUnhealthyInstanceCount()</pre>
</li>
</ul>
<a id="getPendingRequestCounter(java.lang.String)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getPendingRequestCounter</h4>
<pre class="methodSignature">public&nbsp;int&nbsp;getPendingRequestCounter&#8203;(java.lang.String&nbsp;instance)</pre>
</li>
</ul>
<a id="close()">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>close</h4>
<pre class="methodSignature">public&nbsp;void&nbsp;close()
           throws java.io.IOException</pre>
<dl>
<dt><span class="overrideSpecifyLabel">Specified by:</span></dt>
<dd><code>close</code>&nbsp;in interface&nbsp;<code>java.lang.AutoCloseable</code></dd>
<dt><span class="overrideSpecifyLabel">Specified by:</span></dt>
<dd><code>close</code>&nbsp;in interface&nbsp;<code>java.io.Closeable</code></dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code>java.io.IOException</code></dd>
</dl>
</li>
</ul>
</li>
</ul>
</section>
</li>
</ul>
</div>
</div>
</main>
<!-- ========= END OF CLASS DATA ========= -->
<footer role="contentinfo">
<nav role="navigation">
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a id="navbar.bottom">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.bottom" title="Skip navigation links">Skip navigation links</a></div>
<a id="navbar.bottom.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../index.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../../../allclasses.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor.summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor.detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a id="skip.navbar.bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
</nav>
</footer>
</body>
</html>
